<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Egg Sorter Dashboard</title>

<style>
body { font-family: Arial; background:#f5f7fa; text-align:center; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin:30px; }
.card { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,.1); }
.controls button { padding:10px 16px; margin:5px; border:none; border-radius:6px; cursor:pointer; }
.blue { background:#3498db; color:white; }
.red { background:#e74c3c; color:white; }
.green { background:#2ecc71; color:white; }
.manual { display:flex; justify-content:center; gap:8px; margin-top:20px; }
</style>
</head>

<body>

<h1>ðŸ¥š Egg Sorter Dashboard</h1>

<div class="controls">
    <button class="blue" onclick="location.href='/report/daily'">ðŸ“„ Daily PDF</button>
    <button class="blue" onclick="location.href='/report/weekly'">ðŸ“„ Weekly PDF</button>
    <button class="red" onclick="resetDashboard()">Reset Dashboard</button>
</div>

<div class="grid" id="stats"></div>

<h2 style="text-align:center;">Manual Add</h2>
<div class="manual">
    <input id="qty" type="number" min="1" max="5" value="1">
    <select id="size"><option>small</option><option>medium</option><option>large</option><option>xlarge</option></select>
    <select id="color"><option>white</option><option>brown</option></select>
    <select id="quality"><option>good</option><option>bad</option></select>
    <button class="green" onclick="manualAdd()">Add</button>
</div>

<script>
async function refreshData() {
    const r = await fetch("/api/data");
    const d = await r.json();
    const box = document.getElementById("stats");
    box.innerHTML = "";

    Object.entries(d.counters).forEach(([k,v]) => {
        box.innerHTML += `<div class="card"><h3>${k}</h3><p>${v}</p></div>`;
    });
    Object.entries(d.sizes).forEach(([k,v]) => {
        box.innerHTML += `<div class="card"><h3>${k}</h3><p>${v}</p></div>`;
    });
}

async function manualAdd() {
    const qty = +qtyInput.value;
    if (qty < 1 || qty > 5) return alert("Max manual add is 5 eggs");

    await fetch("/api/manual-add", {
        method:"POST",
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
            qty, size:size.value, color:color.value, quality:quality.value
        })
    });

    refreshData();
}

async function resetDashboard() {
    await fetch("/api/reset", {method:"POST"});
    refreshData();
}

refreshData();
setInterval(refreshData, 2000);
</script>

</body>
</html>
