<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Egg Sorter Dashboard</title>

<style>
body { font-family: Arial; background:#f5f7fa; text-align:center; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin:30px; }
.card { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,.1); }
.controls button { padding:10px 16px; margin:5px; border:none; border-radius:6px; cursor:pointer; }
.blue { background:#3498db; color:white; }
.red { background:#e74c3c; color:white; }
.green { background:#2ecc71; color:white; }
.manual { display:flex; justify-content:center; gap:8px; margin-top:20px; }
.manual input, .manual select { padding:8px; border-radius:4px; border:1px solid #ddd; }
</style>
</head>

<body>

<h1>ðŸ¥š Egg Sorter Dashboard</h1>

<div class="controls">
    <button class="blue" onclick="location.href='/report/daily'">ðŸ“„ Daily PDF</button>
    <button class="blue" onclick="location.href='/report/weekly'">ðŸ“„ Weekly PDF</button>
    <button class="red" onclick="resetDashboard()">Reset Dashboard</button>
</div>

<div class="grid" id="stats"></div>

<h2 style="text-align:center;">Manual Add</h2>
<div class="manual">
    <input id="qty" type="number" min="1" max="5" value="1" placeholder="Qty (max 5)">
    <select id="size">
        <option value="small">Small</option>
        <option value="medium">Medium</option>
        <option value="large">Large</option>
        <option value="xlarge">XLarge</option>
    </select>
    <select id="color">
        <option value="white">White</option>
        <option value="brown">Brown</option>
    </select>
    <select id="quality">
        <option value="good">Good</option>
        <option value="bad">Bad</option>
    </select>
    <button class="green" onclick="manualAdd()">Add Eggs</button>
</div>

<script>
async function refreshData() {
    try {
        const r = await fetch("/api/data");
        const d = await r.json();
        const box = document.getElementById("stats");
        box.innerHTML = "";

        // Display counters
        Object.entries(d.counters).forEach(([k,v]) => {
            box.innerHTML += `<div class="card"><h3>${k.toUpperCase()}</h3><p style="font-size:2em;font-weight:bold;">${v}</p></div>`;
        });
        
        // Display sizes
        Object.entries(d.sizes).forEach(([k,v]) => {
            box.innerHTML += `<div class="card"><h3>${k.toUpperCase()}</h3><p style="font-size:2em;font-weight:bold;">${v}</p></div>`;
        });
    } catch (error) {
        console.error("Error fetching data:", error);
    }
}

async function manualAdd() {
    // Get values from form
    const qty = +document.getElementById("qty").value;
    const size = document.getElementById("size").value;
    const color = document.getElementById("color").value;
    const quality = document.getElementById("quality").value;
    
    // Validate quantity
    if (qty < 1 || qty > 5) {
        alert("Please enter a quantity between 1 and 5");
        return;
    }

    try {
        const response = await fetch("/api/manual-add", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                qty: qty,
                size: size,
                color: color,
                quality: quality
            })
        });

        if (response.ok) {
            alert(`âœ“ Successfully added ${qty} ${size} ${color} ${quality} egg(s)!`);
            refreshData();
        } else {
            const error = await response.json();
            alert("Error: " + (error.error || "Failed to add eggs"));
        }
    } catch (error) {
        console.error("Error adding eggs:", error);
        alert("Network error. Please try again.");
    }
}

async function resetDashboard() {
    if (!confirm("Reset dashboard display? (Records will remain in database)")) {
        return;
    }
    
    try {
        await fetch("/api/reset", {method: "POST"});
        alert("âœ“ Dashboard reset!");
        refreshData();
    } catch (error) {
        console.error("Error resetting:", error);
        alert("Failed to reset dashboard");
    }
}

// Initial load
refreshData();

// Auto-refresh every 2 seconds
setInterval(refreshData, 2000);
</script>

</body>
</html>